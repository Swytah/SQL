/*
1.INFORMATION ABOUT THE BOOKS (TITLE, AUTHOR, DATE)
2.INFORMATION ABOUT THE MEMBERS(NAME, NUMBER, EMAIL,ADDRESS)
3. BORROW RECORDS
*/
CREATE DATABASE MINI;
USE MINI;

CREATE TABLE IF NOT EXISTS BOOKS(
    BOOK_ID INT PRIMARY KEY AUTO_INCREMENT,
    TITLE VARCHAR(225) NOT NULL,
    AUTHOR VARCHAR(225) NOT NULL,
    PUBLICATION_YEAR INT,
    GENRE VARCHAR(50),
    ISBN VARCHAR(20)
);

CREATE TABLE IF NOT EXISTS MEMBERS(
    MEMBER_ID INT PRIMARY KEY AUTO_INCREMENT,
    NAME VARCHAR(225) NOT NULL,
    ADDRESS VARCHAR(245),
    PHONE_NUMBER VARCHAR(20),
    EMAIL VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS BORROWRECORDS(
    RECORD_ID INT PRIMARY KEY AUTO_INCREMENT,
    MEMBER_ID INT,
    BOOK_ID INT,
    BORROW_DATE DATE,
    RETURN_DATE DATE,
    FOREIGN KEY(MEMBER_ID) REFERENCES MEMBERS(MEMBER_ID),
    FOREIGN KEY(BOOK_ID) REFERENCES BOOKS(BOOK_ID)
);

INSERT INTO BOOKS (TITLE, AUTHOR, PUBLICATION_YEAR, GENRE, ISBN)
VALUES 
('TO KILL A MOCKINGBIRD', 'HARPER LEE', 1960, 'FICTION', '9780061120084'),
('1984', 'GEORGE ORWELL', 1949, 'DYSTOPIAN', '9780451524935'),
('PRIDE AND PREJUDICE', 'JANE AUSTEN', 1813, 'ROMANCE', '9781503290563'),
('THE GREAT GATSBY', 'F. SCOTT FITZGERALD', 1925, 'CLASSIC', '9780743273565'),
('THE HOBBIT', 'J.R.R. TOLKIEN', 1937, 'FANTASY', '9780547928227'),
('BRAVE NEW WORLD', 'ALDOUS HUXLEY', 1932, 'DYSTOPIAN', '9780060850524'),
('THE CATCHER IN THE RYE', 'J.D. SALINGER', 1951, 'FICTION', '9780316769488'),
('MOBY-DICK', 'HERMAN MELVILLE', 1851, 'ADVENTURE', '9781503280786'),
('LORD OF THE FLIES', 'WILLIAM GOLDING', 1954, 'FICTION', '9780399501487'),
('ANIMAL FARM', 'GEORGE ORWELL', 1945, 'SATIRE', '9780451526342');

INSERT INTO MEMBERS (NAME, ADDRESS, PHONE_NUMBER, EMAIL)
VALUES 
('JOHN DOE', '123 ELM STREET', '123-456-7890', 'JOHN.DOE@EXAMPLE.COM'),
('JANE SMITH', '456 OAK AVENUE', '987-654-3210', 'JANE.SMITH@EXAMPLE.COM'),
('ROBERT BROWN', '789 PINE ROAD', '555-123-4567', 'ROBERT.BROWN@EXAMPLE.COM'),
('LUCY JOHNSON', '101 MAPLE STREET', '555-765-4321', 'LUCY.JOHNSON@EXAMPLE.COM'),
('DAVID WILLIAMS', '202 BIRCH AVENUE', '444-321-6789', 'DAVID.WILLIAMS@EXAMPLE.COM'),
('MARY JONES', '303 SPRUCE LANE', '111-222-3333', 'MARY.JONES@EXAMPLE.COM'),
('JAMES MILLER', '404 WILLOW STREET', '222-333-4444', 'JAMES.MILLER@EXAMPLE.COM'),
('PATRICIA DAVIS', '505 CEDAR COURT', '333-444-5555', 'PATRICIA.DAVIS@EXAMPLE.COM'),
('MICHAEL GARCIA', '606 FIR DRIVE', '444-555-6666', 'MICHAEL.GARCIA@EXAMPLE.COM'),
('LINDA MARTINEZ', '707 HEMLOCK PLACE', '555-666-7777', 'LINDA.MARTINEZ@EXAMPLE.COM');

INSERT INTO BORROWRECORDS (MEMBER_ID, BOOK_ID, BORROW_DATE, RETURN_DATE)
VALUES
(1, 3, '2024-01-10', '2024-01-24'),
(2, 5, '2024-02-01', '2024-02-15'),
(3, 2, '2024-03-15', '2024-03-29'),
(4, 1, '2024-04-05', NULL),
(5, 4, '2024-05-20', NULL),
(6, 7, '2024-06-01', '2024-06-15'),
(7, 8, '2024-06-20', '2024-07-05'),
(8, 6, '2024-07-10', '2024-07-24'),
(9, 9, '2024-07-25', NULL),
(10, 10, '2024-08-01', NULL);

SELECT NAME, ADDRESS FROM MEMBERS;
SELECT AUTHOR,TITLE FROM BOOKS;
-- ALL BOOKS BORROWED BY A USER
SELECT M.NAME, B.TITLE ,R.BORROW_DATE,R.RETURN_DATE
FROM MEMBERS M 
JOIN BORROWRECORDS R ON M.MEMBER_ID = R.MEMBER_ID 
JOIN BOOKS B ON R.BOOK_ID = B.BOOK_ID ;
-- COUNTING NUMBER OF BOOKS IN EACH CATGEORY
SELECT COUNT(*) AS NUMBER_OF_BOOKS , GENRE FROM BOOKS GROUP BY GENRE;
-- AVERAGE YEAR WHERE MOST OF THE BOOK PUBLISHED
SELECT AVG(PUBLICATION_YEAR) AS AVERAGE FROM BOOKS;
-- YEAR WHEN THE MOST BOOKS ARE PUBLISHED
SELECT PUBLICATION_YEAR, COUNT(*) AS BOOK_COUNT
FROM BOOKS
GROUP BY PUBLICATION_YEAR
ORDER BY BOOK_COUNT DESC
LIMIT 1;
-- BOOKS THAT ARE NOT RETURNED IN THIRY DAYS
SELECT M.NAME, B.TITLE ,R.BORROW_DATE
FROM MEMBERS M 
JOIN BORROWRECORDS R ON M.MEMBER_ID = R.MEMBER_ID 
JOIN BOOKS B ON R.BOOK_ID = B.BOOK_ID WHERE datediff(CURDATE(),BORROW_DATE)>30;

